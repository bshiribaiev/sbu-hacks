{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/shiribaiev/Library/CloudStorage/GoogleDrive-bekbolnyc%40gmail.com/My%20Drive/Coding/sbu-hacks/renderer/app/api/upload-evidence/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { writeFile, mkdir } from 'fs/promises'\nimport path from 'path'\nimport { existsSync } from 'fs'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const formData = await request.formData()\n    const file = formData.get('file') as File\n    const sceneId = formData.get('sceneId') as string\n    const sceneName = formData.get('sceneName') as string\n\n    if (!file) {\n      return NextResponse.json({ error: 'No file provided' }, { status: 400 })\n    }\n\n    // Validate file size (50MB limit for GLB models)\n    if (file.size > 50 * 1024 * 1024) {\n      return NextResponse.json({ error: 'File too large (max 50MB)' }, { status: 400 })\n    }\n\n    // Check if file is a GLB model\n    const isGLB = file.name.toLowerCase().endsWith('.glb') || file.type === 'model/gltf-binary'\n\n    let targetDir: string\n    let fileUrl: string\n    let filename: string\n\n    if (isGLB) {\n      // GLB files go to the scene's model folder (e.g., public/models/room/)\n      targetDir = path.join(process.cwd(), 'public', 'models', sceneId || 'general')\n      \n      // Use original filename for GLB (makes it easier to identify in analysis)\n      const sanitizedName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_')\n      filename = sanitizedName\n      fileUrl = `/models/${sceneId || 'general'}/${filename}`\n      \n      console.log('ðŸ“¦ Uploading GLB model to scene folder:', targetDir)\n    } else {\n      // Other files (images, docs) go to uploads folder\n      targetDir = path.join(process.cwd(), 'public', 'uploads', sceneId || 'general')\n      \n      // Add timestamp to prevent collisions for non-GLB files\n      const timestamp = Date.now()\n      const sanitizedName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_')\n      filename = `${timestamp}-${sanitizedName}`\n      fileUrl = `/uploads/${sceneId || 'general'}/${filename}`\n      \n      console.log('ðŸ“„ Uploading evidence file to uploads folder:', targetDir)\n    }\n\n    // Create target directory if it doesn't exist\n    if (!existsSync(targetDir)) {\n      await mkdir(targetDir, { recursive: true })\n    }\n\n    const filepath = path.join(targetDir, filename)\n\n    // Convert file to buffer and save\n    const bytes = await file.arrayBuffer()\n    const buffer = Buffer.from(bytes)\n    await writeFile(filepath, buffer)\n\n    const uploadedFile = {\n      id: `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      name: file.name,\n      type: file.type,\n      size: file.size,\n      url: fileUrl,\n      uploadedAt: new Date().toISOString(),\n      sceneId,\n      sceneName,\n      isGLB,\n    }\n\n    console.log(`âœ… File uploaded: ${uploadedFile.name} to ${fileUrl}`)\n\n    return NextResponse.json({ \n      success: true, \n      file: uploadedFile \n    })\n  } catch (error) {\n    console.error('Error uploading file:', error)\n    return NextResponse.json(\n      { error: 'Failed to upload file' },\n      { status: 500 }\n    )\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,UAAU,SAAS,GAAG,CAAC;QAC7B,MAAM,YAAY,SAAS,GAAG,CAAC;QAE/B,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,iDAAiD;QACjD,IAAI,KAAK,IAAI,GAAG,KAAK,OAAO,MAAM;YAChC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,+BAA+B;QAC/B,MAAM,QAAQ,KAAK,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,WAAW,KAAK,IAAI,KAAK;QAExE,IAAI;QACJ,IAAI;QACJ,IAAI;QAEJ,IAAI,OAAO;YACT,uEAAuE;YACvE,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,UAAU,WAAW;YAEpE,0EAA0E;YAC1E,MAAM,gBAAgB,KAAK,IAAI,CAAC,OAAO,CAAC,mBAAmB;YAC3D,WAAW;YACX,UAAU,CAAC,QAAQ,EAAE,WAAW,UAAU,CAAC,EAAE,UAAU;YAEvD,QAAQ,GAAG,CAAC,2CAA2C;QACzD,OAAO;YACL,kDAAkD;YAClD,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,WAAW,WAAW;YAErE,wDAAwD;YACxD,MAAM,YAAY,KAAK,GAAG;YAC1B,MAAM,gBAAgB,KAAK,IAAI,CAAC,OAAO,CAAC,mBAAmB;YAC3D,WAAW,GAAG,UAAU,CAAC,EAAE,eAAe;YAC1C,UAAU,CAAC,SAAS,EAAE,WAAW,UAAU,CAAC,EAAE,UAAU;YAExD,QAAQ,GAAG,CAAC,iDAAiD;QAC/D;QAEA,8CAA8C;QAC9C,IAAI,CAAC,IAAA,2GAAU,EAAC,YAAY;YAC1B,MAAM,IAAA,8HAAK,EAAC,WAAW;gBAAE,WAAW;YAAK;QAC3C;QAEA,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,WAAW;QAEtC,kCAAkC;QAClC,MAAM,QAAQ,MAAM,KAAK,WAAW;QACpC,MAAM,SAAS,OAAO,IAAI,CAAC;QAC3B,MAAM,IAAA,kIAAS,EAAC,UAAU;QAE1B,MAAM,eAAe;YACnB,IAAI,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;YAC9D,MAAM,KAAK,IAAI;YACf,MAAM,KAAK,IAAI;YACf,MAAM,KAAK,IAAI;YACf,KAAK;YACL,YAAY,IAAI,OAAO,WAAW;YAClC;YACA;YACA;QACF;QAEA,QAAQ,GAAG,CAAC,CAAC,iBAAiB,EAAE,aAAa,IAAI,CAAC,IAAI,EAAE,SAAS;QAEjE,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;QACR;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}